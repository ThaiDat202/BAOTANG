USE [BAOTANG]
GO
/****** Object:  User [NV001]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV001] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [NV002]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV002] FOR LOGIN [TDA] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [NV003]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV003] FOR LOGIN [LTH] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [NV004]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV004] FOR LOGIN [HVT] WITH DEFAULT_SCHEMA=[NV004]
GO
/****** Object:  User [NV005]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV005] FOR LOGIN [NTL] WITH DEFAULT_SCHEMA=[NV005]
GO
/****** Object:  User [NV006]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV006] FOR LOGIN [HTB] WITH DEFAULT_SCHEMA=[NV006]
GO
/****** Object:  User [NV007]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV007] FOR LOGIN [DVH] WITH DEFAULT_SCHEMA=[NV007]
GO
/****** Object:  User [NV008]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV008] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[NV008]
GO
/****** Object:  User [NV009]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV009] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[NV009]
GO
/****** Object:  User [NV123]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE USER [NV123] FOR LOGIN [HVD] WITH DEFAULT_SCHEMA=[NV123]
GO
/****** Object:  DatabaseRole [ADMIN]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE ROLE [ADMIN]
GO
/****** Object:  DatabaseRole [EMPLOYEE]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE ROLE [EMPLOYEE]
GO
/****** Object:  DatabaseRole [MANAGER]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE ROLE [MANAGER]
GO
ALTER ROLE [MANAGER] ADD MEMBER [NV001]
GO
ALTER ROLE [db_owner] ADD MEMBER [NV001]
GO
ALTER ROLE [EMPLOYEE] ADD MEMBER [NV002]
GO
ALTER ROLE [db_datareader] ADD MEMBER [NV002]
GO
ALTER ROLE [ADMIN] ADD MEMBER [NV003]
GO
ALTER ROLE [db_owner] ADD MEMBER [NV003]
GO
ALTER ROLE [EMPLOYEE] ADD MEMBER [NV004]
GO
ALTER ROLE [db_datareader] ADD MEMBER [NV004]
GO
ALTER ROLE [EMPLOYEE] ADD MEMBER [NV005]
GO
ALTER ROLE [db_datareader] ADD MEMBER [NV005]
GO
ALTER ROLE [MANAGER] ADD MEMBER [NV006]
GO
ALTER ROLE [db_owner] ADD MEMBER [NV006]
GO
ALTER ROLE [MANAGER] ADD MEMBER [NV007]
GO
ALTER ROLE [db_owner] ADD MEMBER [NV007]
GO
ALTER ROLE [EMPLOYEE] ADD MEMBER [NV008]
GO
ALTER ROLE [db_datareader] ADD MEMBER [NV008]
GO
ALTER ROLE [MANAGER] ADD MEMBER [NV009]
GO
ALTER ROLE [db_owner] ADD MEMBER [NV009]
GO
ALTER ROLE [EMPLOYEE] ADD MEMBER [NV123]
GO
ALTER ROLE [db_datareader] ADD MEMBER [NV123]
GO
ALTER ROLE [db_owner] ADD MEMBER [ADMIN]
GO
ALTER ROLE [db_datareader] ADD MEMBER [EMPLOYEE]
GO
ALTER ROLE [db_owner] ADD MEMBER [MANAGER]
GO
/****** Object:  Schema [NV004]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV004]
GO
/****** Object:  Schema [NV005]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV005]
GO
/****** Object:  Schema [NV006]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV006]
GO
/****** Object:  Schema [NV007]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV007]
GO
/****** Object:  Schema [NV008]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV008]
GO
/****** Object:  Schema [NV009]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV009]
GO
/****** Object:  Schema [NV123]    Script Date: 2023-07-11 09:57:56 PM ******/
CREATE SCHEMA [NV123]
GO
/****** Object:  UserDefinedFunction [dbo].[Check_Account]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[Check_Account] (@MANV NCHAR(10))
RETURNS BIT
AS
BEGIN
	IF EXISTS(SELECT * FROM sys.sysusers WHERE name = @MANV)
		RETURN 1
	
	RETURN 0
END;
GO
/****** Object:  UserDefinedFunction [dbo].[Check_IDBST]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[Check_IDBST] (@IDBST nchar(10))
RETURNS bit
AS
BEGIN
    DECLARE @Check bit;

    IF EXISTS (SELECT 1 FROM LOAIDIMUON WHERE IDBST = @IDBST)
        SET @Check = 1;
    ELSE
        SET @Check = 0;

    RETURN @Check;
END;
GO
/****** Object:  Table [dbo].[DIEUKHACVATACTUONG]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DIEUKHACVATACTUONG](
	[MATPNT] [nchar](10) NOT NULL,
	[VATLIEU] [nvarchar](50) NULL,
	[CHIEUCAO] [nvarchar](10) NULL,
	[KHOILUONG] [nvarchar](10) NULL,
	[PHONGCACH] [nvarchar](50) NULL,
 CONSTRAINT [PK_DIEUKHACVATACTUONG] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TACGIA]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TACGIA](
	[IDTACGIA] [nchar](10) NOT NULL,
	[TENTACGIA] [nvarchar](50) NULL,
	[NGAYSINH] [date] NULL,
	[NGAYMAT] [date] NULL,
	[QUOCTICH] [nvarchar](50) NULL,
	[THOIDAI] [nvarchar](50) NULL,
	[PHONGCACH] [nvarchar](50) NULL,
	[LOIDIENGIAI] [nvarchar](100) NULL,
 CONSTRAINT [PK_TACGIA] PRIMARY KEY CLUSTERED 
(
	[IDTACGIA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TPNT]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPNT](
	[MATPNT] [nchar](10) NOT NULL,
	[TENTPNT] [nvarchar](50) NULL,
	[NAMSANGTAC] [int] NULL,
	[CHUDE] [nvarchar](100) NULL,
	[IDTACGIA] [nchar](10) NOT NULL,
 CONSTRAINT [PK_TPNT] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VIEW_DIEUKHACTACTUONG]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VIEW_DIEUKHACTACTUONG]
AS
SELECT DKTT.MATPNT AS [MÃ TPNT], 
       TPNT.TENTPNT AS [TÊN TPNT],
       TPNT.NAMSANGTAC AS [NĂM SÁNG TÁC],
       TPNT.CHUDE AS [CHỦ ĐỀ],
       TG.TENTACGIA AS [TÊN TÁC GIẢ],
       DKTT.VATLIEU AS [VẬT LIỆU],
	   DKTT.CHIEUCAO AS [CHIỀU CAO],
	   DKTT.KHOILUONG AS [KHỐI LƯỢNG],
	   DKTT.PHONGCACH AS [PHONG CÁCH]
FROM dbo.DIEUKHACVATACTUONG DKTT
JOIN TPNT ON TPNT.MATPNT = DKTT.MATPNT
JOIN TACGIA TG ON TG.IDTACGIA = TPNT.IDTACGIA;
GO
/****** Object:  Table [dbo].[LOAIHINHKHAC]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOAIHINHKHAC](
	[MATPNT] [nchar](10) NOT NULL,
	[THELOAI] [nvarchar](50) NULL,
	[PHONGCACH] [nvarchar](50) NULL,
 CONSTRAINT [PK_LOAIHINHKHAC] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VIEW_LOAIHINHKHAC]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VIEW_LOAIHINHKHAC]
AS
SELECT LHK.MATPNT AS [MÃ TPNT], 
       TPNT.TENTPNT AS [TÊN TPNT],
       TPNT.NAMSANGTAC AS [NĂM SÁNG TÁC],
       TPNT.CHUDE AS [CHỦ ĐỀ],
       TG.TENTACGIA AS [TÊN TÁC GIẢ],
       LHK.THELOAI AS [THỂ LOẠI],
	   LHK.PHONGCACH AS [PHONG CÁCH]
FROM dbo.LOAIHINHKHAC LHK
JOIN TPNT ON TPNT.MATPNT = LHK.MATPNT
JOIN TACGIA TG ON TG.IDTACGIA = TPNT.IDTACGIA;
GO
/****** Object:  View [dbo].[VIEW_TPNT]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO








CREATE VIEW [dbo].[VIEW_TPNT] 
AS
SELECT TP.MATPNT , TP.TENTPNT,
TENTACGIA = (SELECT TG.TENTACGIA FROM TACGIA TG WHERE TG.IDTACGIA = TP.IDTACGIA),
TP.CHUDE
FROM TPNT TP
GO
/****** Object:  Table [dbo].[HOIHOA]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HOIHOA](
	[MATPNT] [nchar](10) NOT NULL,
	[CHATLIEU] [nvarchar](50) NULL,
	[VATLIEU] [nvarchar](50) NULL,
	[TRUONGPHAI] [nvarchar](50) NULL,
 CONSTRAINT [PK_HOIHOA] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VIEW_HOIHOA]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VIEW_HOIHOA]
AS
SELECT HH.MATPNT AS [MÃ TPNT], 
       TPNT.TENTPNT AS [TÊN TPNT],
       TPNT.NAMSANGTAC AS [NĂM SÁNG TÁC],
       TPNT.CHUDE AS [CHỦ ĐỀ],
       TG.TENTACGIA AS [TÊN TÁC GIẢ],
       HH.CHATLIEU AS [CHẤT LIỆU],
       HH.VATLIEU AS [VẬT LIỆU],
       HH.TRUONGPHAI AS [TRƯỜNG PHÁI]
FROM HOIHOA HH
JOIN TPNT ON TPNT.MATPNT = HH.MATPNT
JOIN TACGIA TG ON TG.IDTACGIA = TPNT.IDTACGIA;
GO
/****** Object:  Table [dbo].[BOSUUTAP]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BOSUUTAP](
	[IDBST] [nchar](10) NOT NULL,
	[TENBST] [nvarchar](50) NULL,
	[HINHTHUCSUUTAP] [nvarchar](100) NULL,
	[MANV] [nchar](10) NULL,
 CONSTRAINT [PK_BOSUUTAP] PRIMARY KEY CLUSTERED 
(
	[IDBST] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CT_CUOCTRIENLAM]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CT_CUOCTRIENLAM](
	[MATPNT] [nchar](10) NOT NULL,
	[IDCTL] [nchar](10) NOT NULL,
 CONSTRAINT [PK_CHITIETCUOCTRIENLAM] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC,
	[IDCTL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CUOCTRIENLAM]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CUOCTRIENLAM](
	[IDCTL] [nchar](10) NOT NULL,
	[TENTRIENLAM] [nvarchar](50) NULL,
	[NGAYBATDAU] [date] NULL,
	[NGAYKETTHUC] [date] NULL,
 CONSTRAINT [PK_CUOCTRIENLAM] PRIMARY KEY CLUSTERED 
(
	[IDCTL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOAIDIMUON](
	[MATPNT] [nchar](10) NOT NULL,
	[IDBST] [nchar](10) NULL,
	[NGAYMUON] [date] NULL,
	[NGAYTRA] [date] NULL,
 CONSTRAINT [PK_LOAIDIMUON] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOAISOHUU](
	[MATPNT] [nchar](10) NOT NULL,
	[NGAYSOHUU] [date] NULL,
	[TINHTRANG] [nvarchar](50) NULL,
	[TRIGIA] [money] NULL,
 CONSTRAINT [PK_LOAISOHUU] PRIMARY KEY CLUSTERED 
(
	[MATPNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NHANVIEN]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NHANVIEN](
	[MANV] [nchar](10) NOT NULL,
	[HO] [nvarchar](30) NULL,
	[TEN] [nvarchar](20) NULL,
	[CMND] [nchar](10) NULL,
	[DIACHI] [nvarchar](50) NULL,
	[SDT] [nchar](10) NULL,
	[CHUCVU] [nvarchar](20) NULL,
PRIMARY KEY CLUSTERED 
(
	[MANV] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST001    ', N'Bộ sưu tập 1', N'Tranh', N'NV001     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST002    ', N'Bộ sưu tập 2', N'Điêu khắc', N'NV007     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST003    ', N'Bộ sưu tập 3', N'Vẽ', N'NV002     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST004    ', N'Bộ sưu tập 4', N'Triển lãm', N'NV001     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST005    ', N'Bộ sưu tập 5', N'Trưng bày', N'NV002     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST006    ', N'Bộ sưu tập 6', N'Lưu trữ', N'NV003     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST007    ', N'Bộ sưu tập 7', N'Bảo tàng', N'NV005     ')
INSERT [dbo].[BOSUUTAP] ([IDBST], [TENBST], [HINHTHUCSUUTAP], [MANV]) VALUES (N'BST008    ', N'Bộ sưu tập 8', N'Giáo dục', N'NV006     ')
GO
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT001   ', N'CTL001    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT001   ', N'CTL004    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT003   ', N'CTL004    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT004   ', N'CTL002    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT005   ', N'CTL001    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT005   ', N'CTL004    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT006   ', N'CTL002    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT008   ', N'CTL002    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT008   ', N'CTL004    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT009   ', N'CTL001    ')
INSERT [dbo].[CT_CUOCTRIENLAM] ([MATPNT], [IDCTL]) VALUES (N'TPNT009   ', N'CTL004    ')
GO
INSERT [dbo].[CUOCTRIENLAM] ([IDCTL], [TENTRIENLAM], [NGAYBATDAU], [NGAYKETTHUC]) VALUES (N'CTL001    ', N'Hội chợ', CAST(N'2023-07-11' AS Date), CAST(N'2023-08-04' AS Date))
INSERT [dbo].[CUOCTRIENLAM] ([IDCTL], [TENTRIENLAM], [NGAYBATDAU], [NGAYKETTHUC]) VALUES (N'CTL002    ', N'Hội Thảo', CAST(N'2023-07-04' AS Date), CAST(N'2023-08-04' AS Date))
INSERT [dbo].[CUOCTRIENLAM] ([IDCTL], [TENTRIENLAM], [NGAYBATDAU], [NGAYKETTHUC]) VALUES (N'CTL004    ', N'Mùa Xuân', CAST(N'2023-07-11' AS Date), CAST(N'2023-07-29' AS Date))
GO
INSERT [dbo].[DIEUKHACVATACTUONG] ([MATPNT], [VATLIEU], [CHIEUCAO], [KHOILUONG], [PHONGCACH]) VALUES (N'TPNT001   ', N'Gỗ', N'100 cm', N'10 kg', N'Hiện đại')
INSERT [dbo].[DIEUKHACVATACTUONG] ([MATPNT], [VATLIEU], [CHIEUCAO], [KHOILUONG], [PHONGCACH]) VALUES (N'TPNT002   ', N'Ðá', N'80 cm', N'20 kg', N'Cổ điển')
INSERT [dbo].[DIEUKHACVATACTUONG] ([MATPNT], [VATLIEU], [CHIEUCAO], [KHOILUONG], [PHONGCACH]) VALUES (N'TPNT003   ', N'Sắt', N'120 cm', N'15 kg', N'Hiện đại')
INSERT [dbo].[DIEUKHACVATACTUONG] ([MATPNT], [VATLIEU], [CHIEUCAO], [KHOILUONG], [PHONGCACH]) VALUES (N'TPNT011   ', N'Gỗ                            ', N'50cm      ', N'12kg      ', N'Hiện đại                                          ')
GO
INSERT [dbo].[HOIHOA] ([MATPNT], [CHATLIEU], [VATLIEU], [TRUONGPHAI]) VALUES (N'TPNT004   ', N'Màu nước', N'Giấy', N'Tranh cảnh')
INSERT [dbo].[HOIHOA] ([MATPNT], [CHATLIEU], [VATLIEU], [TRUONGPHAI]) VALUES (N'TPNT005   ', N'Màu dầu', N'Vải', N'Tranh chân dung')
INSERT [dbo].[HOIHOA] ([MATPNT], [CHATLIEU], [VATLIEU], [TRUONGPHAI]) VALUES (N'TPNT006   ', N'Acrylic', N'Ván', N'Tranh trừu tượng')
GO
INSERT [dbo].[LOAIDIMUON] ([MATPNT], [IDBST], [NGAYMUON], [NGAYTRA]) VALUES (N'TPNT002   ', N'BST002    ', CAST(N'2023-02-01' AS Date), CAST(N'2023-02-10' AS Date))
INSERT [dbo].[LOAIDIMUON] ([MATPNT], [IDBST], [NGAYMUON], [NGAYTRA]) VALUES (N'TPNT004   ', N'BST006    ', CAST(N'2023-06-04' AS Date), CAST(N'2023-06-12' AS Date))
INSERT [dbo].[LOAIDIMUON] ([MATPNT], [IDBST], [NGAYMUON], [NGAYTRA]) VALUES (N'TPNT005   ', N'BST003    ', CAST(N'2023-03-03' AS Date), CAST(N'2023-03-23' AS Date))
INSERT [dbo].[LOAIDIMUON] ([MATPNT], [IDBST], [NGAYMUON], [NGAYTRA]) VALUES (N'TPNT008   ', N'BST005    ', CAST(N'2023-09-01' AS Date), CAST(N'2023-09-10' AS Date))
GO
INSERT [dbo].[LOAIHINHKHAC] ([MATPNT], [THELOAI], [PHONGCACH]) VALUES (N'TPNT007   ', N'Kiến trúc', N'Hiện đại')
INSERT [dbo].[LOAIHINHKHAC] ([MATPNT], [THELOAI], [PHONGCACH]) VALUES (N'TPNT008   ', N'Tranh', N'Cổ điển')
INSERT [dbo].[LOAIHINHKHAC] ([MATPNT], [THELOAI], [PHONGCACH]) VALUES (N'TPNT009   ', N'Điêu khắc', N'Truyền thống')
GO
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT001   ', CAST(N'2023-01-01' AS Date), N'Tốt', 5000000.0000)
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT003   ', CAST(N'2023-03-01' AS Date), N'Mới', 8000000.0000)
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT006   ', CAST(N'2023-03-01' AS Date), N'Mới', 8000000.0000)
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT007   ', CAST(N'2023-01-01' AS Date), N'Tốt', 5000000.0000)
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT009   ', CAST(N'2023-03-01' AS Date), N'Mới', 8000000.0000)
INSERT [dbo].[LOAISOHUU] ([MATPNT], [NGAYSOHUU], [TINHTRANG], [TRIGIA]) VALUES (N'TPNT011   ', CAST(N'2023-07-11' AS Date), N'Mới                           ', 100000.0000)
GO
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV001     ', N'Nguyễn Văn', N'Tèo', N'241883010 ', N'Hà Nội', N'0333333333', N'Quản Lý')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV002     ', N'Trần Đức', N'Anh', N'241882456 ', N'Hồ Chí Minh', N'0444444444', N'Nhân Viên')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV003     ', N'Lê Thị', N'Hà', N'241881357 ', N'Đà Nẵng', N'0555555555', N'Admin')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV004     ', N'Hồ Văn', N'Tín', N'241882049 ', N'Hà Nam', N'0666666666', N'Nhân Viên')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV005     ', N'Nguyễn Thị', N'Lành', N'241882345 ', N'Đắk Lắk', N'0777777777', N'Nhân Viên')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV006     ', N'Hồ Thái', N'Bảo', N'241884356 ', N'Đồng Nai', N'0888888888', N'Quản Lý')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV007     ', N'Đỗ Văn', N'Hậu', N'241884144 ', N'Long An', N'0999999999', N'Quản Lý')
INSERT [dbo].[NHANVIEN] ([MANV], [HO], [TEN], [CMND], [DIACHI], [SDT], [CHUCVU]) VALUES (N'NV123     ', N'Hoàng Văn', N'Đức', N'241883287 ', N'Hà Nội', N'0298765432', N'Nhân Viên')
GO
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG001     ', N'Nguyễn Thị Hương', CAST(N'1990-01-01' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 1')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG002     ', N'Đào Duy Từ', CAST(N'1985-03-10' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 2')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG003     ', N'Đỗ Văn Đậu', CAST(N'1990-01-01' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 3')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG004     ', N'Hoàng Quốc Việt', CAST(N'1985-03-10' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 4')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG005     ', N'Lê Duy Nghĩa', CAST(N'1990-01-01' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 5')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG006     ', N'Hoàng Lan Anh', CAST(N'1985-03-10' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 6')
INSERT [dbo].[TACGIA] ([IDTACGIA], [TENTACGIA], [NGAYSINH], [NGAYMAT], [QUOCTICH], [THOIDAI], [PHONGCACH], [LOIDIENGIAI]) VALUES (N'TG007     ', N'Hồ Văn Báo', CAST(N'1994-06-14' AS Date), NULL, N'Việt Nam', N'Hiện đại', N'Châu Á', N'Mô tả tác giả 7')
GO
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT001   ', N'Tác phẩm 1', 2020, N'Nghệ thuật', N'TG001     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT002   ', N'Tác phẩm 2', 2015, N'Lịch sử', N'TG002     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT003   ', N'Tác phẩm 3', 2018, N'Truyền thống', N'TG005     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT004   ', N'Tác phẩm 4', 2020, N'Nghệ thuật', N'TG006     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT005   ', N'Tác phẩm 5', 2015, N'Lịch sử', N'TG002     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT006   ', N'Tác phẩm 6', 2018, N'Truyền thống', N'TG003     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT007   ', N'Tác phẩm 7', 2020, N'Nghệ thuật', N'TG002     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT008   ', N'Tác phẩm 8', 2015, N'Lịch sử', N'TG004     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT009   ', N'Tác phẩm 9', 2018, N'Truyền thống', N'TG005     ')
INSERT [dbo].[TPNT] ([MATPNT], [TENTPNT], [NAMSANGTAC], [CHUDE], [IDTACGIA]) VALUES (N'TPNT011   ', N'Tác phẩm 11                   ', 2023, N'Hội họa', N'TG003     ')
GO
ALTER TABLE [dbo].[BOSUUTAP]  WITH CHECK ADD  CONSTRAINT [FK_BOSUUTAP_NHANVIEN] FOREIGN KEY([MANV])
REFERENCES [dbo].[NHANVIEN] ([MANV])
ON UPDATE CASCADE
GO
ALTER TABLE [dbo].[BOSUUTAP] CHECK CONSTRAINT [FK_BOSUUTAP_NHANVIEN]
GO
ALTER TABLE [dbo].[CT_CUOCTRIENLAM]  WITH CHECK ADD  CONSTRAINT [FK_CT_CUOCTRIENLAM_CUOCTRIENLAM] FOREIGN KEY([IDCTL])
REFERENCES [dbo].[CUOCTRIENLAM] ([IDCTL])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[CT_CUOCTRIENLAM] CHECK CONSTRAINT [FK_CT_CUOCTRIENLAM_CUOCTRIENLAM]
GO
ALTER TABLE [dbo].[CT_CUOCTRIENLAM]  WITH CHECK ADD  CONSTRAINT [FK_CT_CUOCTRIENLAM_TPNT] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
GO
ALTER TABLE [dbo].[CT_CUOCTRIENLAM] CHECK CONSTRAINT [FK_CT_CUOCTRIENLAM_TPNT]
GO
ALTER TABLE [dbo].[DIEUKHACVATACTUONG]  WITH CHECK ADD  CONSTRAINT [FK_DIEUKHACVATACTUONG] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[DIEUKHACVATACTUONG] CHECK CONSTRAINT [FK_DIEUKHACVATACTUONG]
GO
ALTER TABLE [dbo].[HOIHOA]  WITH CHECK ADD  CONSTRAINT [FK_HOIHOA] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[HOIHOA] CHECK CONSTRAINT [FK_HOIHOA]
GO
ALTER TABLE [dbo].[LOAIDIMUON]  WITH CHECK ADD  CONSTRAINT [FK_LOAIDIMUON] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[LOAIDIMUON] CHECK CONSTRAINT [FK_LOAIDIMUON]
GO
ALTER TABLE [dbo].[LOAIDIMUON]  WITH CHECK ADD  CONSTRAINT [FK_LOAIDIMUON_BOSUUTAP] FOREIGN KEY([IDBST])
REFERENCES [dbo].[BOSUUTAP] ([IDBST])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[LOAIDIMUON] CHECK CONSTRAINT [FK_LOAIDIMUON_BOSUUTAP]
GO
ALTER TABLE [dbo].[LOAIHINHKHAC]  WITH CHECK ADD  CONSTRAINT [FK_LOAIHINHKHAC] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[LOAIHINHKHAC] CHECK CONSTRAINT [FK_LOAIHINHKHAC]
GO
ALTER TABLE [dbo].[LOAISOHUU]  WITH CHECK ADD  CONSTRAINT [FK_LOAISOHUU] FOREIGN KEY([MATPNT])
REFERENCES [dbo].[TPNT] ([MATPNT])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[LOAISOHUU] CHECK CONSTRAINT [FK_LOAISOHUU]
GO
ALTER TABLE [dbo].[TPNT]  WITH CHECK ADD  CONSTRAINT [FK_TACGIA] FOREIGN KEY([IDTACGIA])
REFERENCES [dbo].[TACGIA] ([IDTACGIA])
ON UPDATE CASCADE
GO
ALTER TABLE [dbo].[TPNT] CHECK CONSTRAINT [FK_TACGIA]
GO
/****** Object:  StoredProcedure [dbo].[Lay_Login_Tu_Username]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[Lay_Login_Tu_Username]
@USERNAME NCHAR(9)
AS
	BEGIN
		
		DECLARE @siD NVARCHAR(100)
		SELECT @siD =  sid FROM sys.sysusers 
		WHERE name = @USERNAME
		select name from SYS.syslogins where sid = @siD
	END
GO
/****** Object:  StoredProcedure [dbo].[SP_BackupBaoTangDatabase]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_BackupBaoTangDatabase]
    @BackupPath NVARCHAR(255),
    @NameFile NVARCHAR(128)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @FullBackupPath NVARCHAR(255) = CONCAT(@BackupPath, '\', @NameFile, '.bak');
    DECLARE @DatabaseName NVARCHAR(128) = 'BAOTANG';

    -- Kiểm tra xem tệp backup đã tồn tại hay chưa
    IF EXISTS (SELECT 1 FROM sys.sysdevices WHERE name = 'BaoTangDevices')
    BEGIN
        -- Thực hiện backup database
        BACKUP DATABASE @DatabaseName
        TO DISK = @FullBackupPath
        WITH FORMAT, NAME = 'Full Database Backup';

        -- Hiển thị thông báo khi backup thành công
        PRINT 'Backup database BAOTANG thành công.';
    END
    ELSE
    BEGIN
        -- Hiển thị thông báo khi thiết bị backup chưa được tạo
        PRINT 'Thiết bị backup BaoTangDevices chưa được tạo.';
    END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_CMND]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_CMND]
	@CMND NCHAR(10)
AS
BEGIN
DECLARE @check int
	IF EXISTS(SELECT * FROM dbo.NHANVIEN WHERE dbo.NHANVIEN.CMND = @CMND)
		SET @check = 1	--cmnd đã tồn tại 
	ELSE
		SET @check = 0
SELECT @check	--Không bị trùng được thêm
END
GO
/****** Object:  StoredProcedure [dbo].[SP_DangNhap]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_DangNhap]
	@tenLogin nvarchar(50)
AS
BEGIN
	DECLARE @tenUser nvarchar(50)
	SELECT @tenUser = NAME FROM sys.sysusers WHERE sid = SUSER_SID(@tenLogin)
 
	SELECT USERNAME = @tenUser,
		HOTEN = (SELECT HO + ' ' + TEN FROM NHANVIEN WHERE MANV = @tenUser),
		TENNHOM = NAME
	FROM sys.sysusers 
	WHERE UID = (SELECT GROUPUID
                 FROM SYS.SYSMEMBERS
					WHERE MEMBERUID = (SELECT UID FROM sys.sysusers
										WHERE NAME = @tenUser))
END
GO
/****** Object:  StoredProcedure [dbo].[SP_Delete_Infor_BoSuuTap]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_Delete_Infor_BoSuuTap]
@IDBST NCHAR(10)
AS
BEGIN
	
	IF dbo.Check_IDBST(@IDBST) = 1
	BEGIN
		RAISERROR('Bộ sưu tập này đã tồn tại trong bảng loại đi mượn. Không thể xóa bộ sưu tập này!',16,1)
	END
	ELSE
	BEGIN
		DECLARE @errorMessage NVARCHAR(4000)
		BEGIN TRANSACTION;
		BEGIN TRY
			DELETE FROM BOSUUTAP WHERE IDBST = @IDBST;
			COMMIT;
		END TRY
		BEGIN CATCH
			SET @errorMessage = ERROR_MESSAGE()
			RAISERROR(@errorMessage,16,1)
			ROLLBACK;
		END CATCH;
	END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_Delete_Infor_NhanVien]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_Delete_Infor_NhanVien]
@MANV NCHAR(10)
AS
BEGIN
	
	IF dbo.Check_Account(@MANV) = 1
	BEGIN
		RAISERROR('Nhân viên này đã có tài khoản đăng nhập. Không thể xóa nhân viên này',16,1)
	END
	ELSE
	BEGIN
		DECLARE @errorMessage NVARCHAR(4000)
		BEGIN TRANSACTION;
		BEGIN TRY
			DELETE NHANVIEN WHERE @MANV = MANV
			COMMIT;
		END TRY
		BEGIN CATCH
			SET @errorMessage = ERROR_MESSAGE()
			RAISERROR(@errorMessage,16,1)
			ROLLBACK;
		END CATCH;
	END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_DIEUKHACTACTUONG_ADDLOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_DIEUKHACTACTUONG_ADDLOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@VATLIEU NCHAR(50),
	@CHIEUCAO NCHAR(10),
	@KHOILUONG NCHAR(10),
	@PHONGCACH NCHAR(50),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
			          VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO DIEUKHACVATACTUONG (MATPNT, VATLIEU, CHIEUCAO, KHOILUONG, PHONGCACH)
									VALUES (@MATPNT, @VATLIEU, @CHIEUCAO, @KHOILUONG, @PHONGCACH)

			INSERT INTO LOAIDIMUON (MATPNT, IDBST, NGAYMUON, NGAYTRA)
						  VALUES (@MATPNT, @IDBST, @NGAYMUON, @NGAYTRA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_DIEUKHACTACTUONG_ADDLOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_DIEUKHACTACTUONG_ADDLOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@VATLIEU NCHAR(30),
    @CHIEUCAO NCHAR(10),
	@KHOILUONG NCHAR(10),
	@PHONGCACH NCHAR(50),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
						VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO DIEUKHACVATACTUONG (MATPNT, VATLIEU, CHIEUCAO, KHOILUONG, PHONGCACH)
									VALUES (@MATPNT, @VATLIEU, @CHIEUCAO, @KHOILUONG, @PHONGCACH)

			INSERT INTO LOAISOHUU (MATPNT, NGAYSOHUU, TINHTRANG, TRIGIA)
							VALUES (@MATPNT, @NGAYSOHUU, @TINHTRANG, @TRIGIA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_DIEUKHACTACTUONG_UPDATELOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_DIEUKHACTACTUONG_UPDATELOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@VATLIEU NCHAR(30),
    @CHIEUCAO NCHAR(10),
	@KHOILUONG NCHAR(10),
	@PHONGCACH NCHAR(50),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE DIEUKHACVATACTUONG
			SET VATLIEU = @VATLIEU, CHIEUCAO = @CHIEUCAO, KHOILUONG = @KHOILUONG, PHONGCACH = @PHONGCACH
			WHERE MATPNT = @MATPNT

			UPDATE LOAIDIMUON
			SET IDBST = @IDBST, NGAYMUON = @NGAYMUON, NGAYTRA = @NGAYTRA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_DIEUKHACTACTUONG_UPDATELOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_DIEUKHACTACTUONG_UPDATELOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
    @VATLIEU NCHAR(30),
    @CHIEUCAO NCHAR(10),
	@KHOILUONG NCHAR(10),
	@PHONGCACH NCHAR(50),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE DIEUKHACVATACTUONG
			SET VATLIEU = @VATLIEU, CHIEUCAO = @CHIEUCAO, KHOILUONG = @KHOILUONG, PHONGCACH = @PHONGCACH
			WHERE MATPNT = @MATPNT

			UPDATE LOAISOHUU
			SET NGAYSOHUU = @NGAYSOHUU, TINHTRANG = @TINHTRANG, TRIGIA = @TRIGIA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_DSCTL]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[SP_DSCTL]
	@NgayBD nvarchar(20), 
	@NgayKT nvarchar(20)
AS
BEGIN
	SELECT * FROM CUOCTRIENLAM 
	WHERE NGAYBATDAU >= @NgayBD AND NGAYKETTHUC <= @NgayKT
END
GO
/****** Object:  StoredProcedure [dbo].[SP_DSTPNT]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[SP_DSTPNT]
	@IDTG nchar(10)
AS
BEGIN
	SELECT MATPNT, TENTPNT, NAMSANGTAC, CHUDE 
	FROM TPNT WHERE IDTACGIA = @IDTG

END
GO
/****** Object:  StoredProcedure [dbo].[SP_GETTPNT]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO







CREATE PROC [dbo].[SP_GETTPNT]
    @MaTP VARCHAR(10)
AS
BEGIN

	SELECT MATPNT ,TENTPNT ,
	TENTACGIA = (SELECT TG.TENTACGIA FROM TACGIA TG WHERE TG.IDTACGIA = TP.IDTACGIA ),
	CHUDE
	FROM TPNT TP
	WHERE MATPNT = @MaTP
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GETTPNTBYIDCTL]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_GETTPNTBYIDCTL]
    @IDTrienLam VARCHAR(10)
AS
BEGIN

	SELECT MATPNT ,TENTPNT ,
	TENTACGIA = (SELECT TG.TENTACGIA FROM TACGIA TG WHERE TG.IDTACGIA = TP.IDTACGIA ),
	CHUDE
	FROM TPNT TP
	WHERE MATPNT IN (SELECT MATPNT FROM CT_CUOCTRIENLAM
					WHERE IDCTL = @IDTrienLam )
END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOIHOA_ADDLOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_HOIHOA_ADDLOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@CHATLIEU NCHAR(30),
	@VATLIEU NCHAR(30),
    @TRUONGPHAI NCHAR(30),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
			          VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO HOIHOA (MATPNT, CHATLIEU, VATLIEU, TRUONGPHAI)
					    VALUES (@MATPNT , @CHATLIEU ,@VATLIEU, @TRUONGPHAI)

			INSERT INTO LOAIDIMUON (MATPNT, IDBST, NGAYMUON, NGAYTRA)
						  VALUES (@MATPNT, @IDBST, @NGAYMUON, @NGAYTRA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOIHOA_ADDLOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_HOIHOA_ADDLOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
    @CHATLIEU NCHAR(30),
	@VATLIEU NCHAR(30),
    @TRUONGPHAI NCHAR(30),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
			VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO HOIHOA (MATPNT, CHATLIEU, VATLIEU, TRUONGPHAI)
			VALUES (@MATPNT , @CHATLIEU ,@VATLIEU, @TRUONGPHAI)

			INSERT INTO LOAISOHUU (MATPNT, NGAYSOHUU, TINHTRANG, TRIGIA)
            VALUES (@MATPNT, @NGAYSOHUU, @TINHTRANG, @TRIGIA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOIHOA_UPDATELOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_HOIHOA_UPDATELOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@CHATLIEU NCHAR(30),
	@VATLIEU NCHAR(30),
    @TRUONGPHAI NCHAR(30),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE HOIHOA
			SET CHATLIEU = @CHATLIEU, VATLIEU = @VATLIEU, TRUONGPHAI = @TRUONGPHAI
			WHERE MATPNT = @MATPNT

			UPDATE LOAIDIMUON
			SET IDBST = @IDBST, NGAYMUON = @NGAYMUON, NGAYTRA = @NGAYTRA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOIHOA_UPDATELOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_HOIHOA_UPDATELOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
    @CHATLIEU NCHAR(30),
	@VATLIEU NCHAR(30),
    @TRUONGPHAI NCHAR(30),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE HOIHOA
			SET CHATLIEU = @CHATLIEU, VATLIEU = @VATLIEU, TRUONGPHAI = @TRUONGPHAI
			WHERE MATPNT = @MATPNT

			UPDATE LOAISOHUU
			SET NGAYSOHUU = @NGAYSOHUU, TINHTRANG = @TINHTRANG, TRIGIA = @TRIGIA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_IDBST]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_IDBST]
	@idbst NCHAR(10)
AS
BEGIN
DECLARE @check int
	IF EXISTS(SELECT * FROM dbo.BOSUUTAP WHERE dbo.BOSUUTAP.IDBST = @idbst)
		SET @check = 1	--Mã BST đã tồn tại 
	ELSE
		SET @check = 0
SELECT @check	--Không bị trùng được thêm
END
GO
/****** Object:  StoredProcedure [dbo].[SP_IDTG]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_IDTG]
	@idtg NCHAR(10)
AS
BEGIN
DECLARE @check int
	IF EXISTS(SELECT * FROM dbo.TACGIA WHERE dbo.TACGIA.IDTACGIA = @idtg)
		SET @check = 1	--Mã tg đã tồn tại 
	ELSE
		SET @check = 0
SELECT @check	--Không bị trùng được thêm
END
GO
/****** Object:  StoredProcedure [dbo].[SP_LOAIHINHKHAC_ADDLOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_LOAIHINHKHAC_ADDLOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@THELOAI NCHAR(50),
	@PHONGCACH NCHAR(50),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
			          VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO LOAIHINHKHAC (MATPNT, THELOAI, PHONGCACH)
								VALUES(@MATPNT, @THELOAI, @PHONGCACH)

			INSERT INTO LOAIDIMUON (MATPNT, IDBST, NGAYMUON, NGAYTRA)
						  VALUES (@MATPNT, @IDBST, @NGAYMUON, @NGAYTRA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_LOAIHINHKHAC_ADDLOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_LOAIHINHKHAC_ADDLOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@THELOAI NCHAR(50),
	@PHONGCACH NCHAR(50),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			INSERT INTO TPNT (MATPNT, TENTPNT, NAMSANGTAC, CHUDE, IDTACGIA)
						VALUES (@MATPNT, @TENTPNT, @NAMSANGTAC, @CHUDE, @IDTACGIA)

			INSERT INTO LOAIHINHKHAC (MATPNT, THELOAI, PHONGCACH)
								VALUES(@MATPNT, @THELOAI, @PHONGCACH)

			INSERT INTO LOAISOHUU (MATPNT, NGAYSOHUU, TINHTRANG, TRIGIA)
							VALUES (@MATPNT, @NGAYSOHUU, @TINHTRANG, @TRIGIA)

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Mã TPNT đang nhập trùng với Mã TPNT ở các TPNT khác. Vui lòng chọn Mã TPNT khác!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_LOAIHINHKHAC_UPDATELOAIDIMUON]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_LOAIHINHKHAC_UPDATELOAIDIMUON]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
	@THELOAI NCHAR(50),
	@PHONGCACH NCHAR(50),

	@IDBST NCHAR(10),
	@NGAYMUON DATETIME,
	@NGAYTRA DATETIME

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE LOAIHINHKHAC
			SET THELOAI = @THELOAI, PHONGCACH = @PHONGCACH
			WHERE MATPNT = @MATPNT

			UPDATE LOAIDIMUON
			SET IDBST = @IDBST, NGAYMUON = @NGAYMUON, NGAYTRA = @NGAYTRA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_LOAIHINHKHAC_UPDATELOAISOHUU]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[SP_LOAIHINHKHAC_UPDATELOAISOHUU]
    @MATPNT NCHAR(10),
    @TENTPNT NCHAR(30),
	@NAMSANGTAC INT,
	@CHUDE NVARCHAR(100),
    @IDTACGIA NCHAR(10),
    @THELOAI NCHAR(50),
	@PHONGCACH NCHAR(50),

	@NGAYSOHUU DATETIME,
	@TINHTRANG NCHAR(30),
	@TRIGIA money

AS
BEGIN
	BEGIN TRAN
		BEGIN TRY
			UPDATE TPNT
            SET TENTPNT = @TENTPNT, NAMSANGTAC = @NAMSANGTAC, CHUDE = @CHUDE, IDTACGIA = @IDTACGIA
            WHERE MATPNT = @MATPNT

			UPDATE LOAIHINHKHAC
			SET THELOAI = @THELOAI, PHONGCACH = @PHONGCACH
			WHERE MATPNT = @MATPNT

			UPDATE LOAISOHUU
			SET NGAYSOHUU = @NGAYSOHUU, TINHTRANG = @TINHTRANG, TRIGIA = @TRIGIA
			WHERE MATPNT = @MATPNT

			COMMIT TRAN
		END TRY

		BEGIN CATCH
			ROLLBACK
			RAISERROR(N'Ghi thất bại!', 16, 1)
		END CATCH
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_MANV]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_MANV]
	@maNV NCHAR(10)
AS
BEGIN
DECLARE @check int
	IF EXISTS(SELECT * FROM dbo.NHANVIEN WHERE dbo.NHANVIEN.MANV = @maNV)
		SET @check = 1	--Mã nv đã tồn tại 
	ELSE
		SET @check = 0
SELECT @check	--Không bị trùng được thêm
END


GO
/****** Object:  StoredProcedure [dbo].[SP_MENULOAI]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_MENULOAI]
    @MATPNT VARCHAR(50),
    @Check BIT OUTPUT
AS
BEGIN
    IF EXISTS (SELECT 1 FROM dbo.LOAISOHUU WHERE MATPNT = @MATPNT)
        SET @Check = 1;
    ELSE
        SET @Check = 0;
END
GO
/****** Object:  StoredProcedure [dbo].[SP_SDT]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_SDT]
	@sdt NCHAR(10)
AS
BEGIN
DECLARE @check INT
	IF EXISTS(SELECT * FROM dbo.NHANVIEN WHERE dbo.NHANVIEN.SDT = @sdt)
		SET @check = 1	--sdt đã tồn tại 
	ELSE
		SET @check = 0
SELECT @check	--Không bị trùng được thêm
END
GO
/****** Object:  StoredProcedure [dbo].[SP_TaoTaiKhoan]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_TaoTaiKhoan]
	@LGNAME nvarchar(10),
	@PASS nvarchar(20),
	@USERNAME nvarchar(10),
	@ROLE nvarchar(20)
AS
BEGIN
DECLARE @check int = 0
	DECLARE @RET INT

	EXEC @RET = SP_ADDLOGIN @LGNAME, @PASS, 'BAOTANG'                     
	IF (@RET = 1)	--	LOGIN NAME BI TRUNG
	BEGIN
		SET @check = 1
		SELECT @check
		RETURN 1
	END

	EXEC @RET = SP_GRANTDBACCESS @LGNAME, @USERNAME
	IF (@RET = 1)	--	USER NAME BI TRUNG
	BEGIN
		EXEC SP_DROPLOGIN @LGNAME
		SET @check = 2
		SELECT @check
		RETURN 2
	END

	EXEC sp_addrolemember @ROLE, @USERNAME
	IF @ROLE = 'MANAGER'
	BEGIN
		EXEC sp_addsrvrolemember @LGNAME, 'SecurityAdmin'
		
	END
SELECT @check
END

GO
/****** Object:  StoredProcedure [dbo].[SP_XoaLogin]    Script Date: 2023-07-11 09:57:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[SP_XoaLogin]
  @LGNAME VARCHAR(50),
  @USRNAME VARCHAR(50)
  
AS
BEGIN
  EXEC SP_DROPUSER @USRNAME
  EXEC SP_DROPLOGIN @LGNAME
END
GO

-----------------------------------------------------------
USE master
CREATE PROCEDURE [dbo].[SP_RestoreBaoTangDatabase]    
	@BackupPath NVARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @DatabaseName NVARCHAR(128) = 'BAOTANG';

    -- Kiểm tra xem tệp backup tồn tại hay không
    IF EXISTS (SELECT 1 FROM sys.sysdevices WHERE name = 'BaoTangDevices')
    BEGIN
        -- Kiểm tra xem database đã tồn tại hay chưa
        IF DB_ID(@DatabaseName) IS NOT NULL
        BEGIN
            -- Đóng kết nối đến database nếu đang mở
            IF DB_ID(@DatabaseName) <> DB_ID()
            BEGIN
                ALTER DATABASE BAOTANG SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
            END
            -- Khôi phục database từ tệp backup
            RESTORE DATABASE BAOTANG 
            FROM DISK = @BackupPath
            WITH REPLACE;
            -- Mở kết nối đến database
            ALTER DATABASE BAOTANG SET MULTI_USER;
            
            -- Hiển thị thông báo khi khôi phục thành công
            PRINT 'Khôi phục database BAOTANG thành công.';
        END
        ELSE
        BEGIN
            -- Hiển thị thông báo khi database chưa tồn tại
            PRINT 'Database BAOTANG chưa tồn tại.';
        END
    END
    ELSE
    BEGIN
        -- Hiển thị thông báo khi thiết bị backup chưa được tạo
        PRINT 'Thiết bị backup chưa được tạo.';
    END
END



--------------------------------------------------------
use master;
EXEC sp_addumpdevice 'disk', 'BaoTangDevices', 'C:\SQLBackups\BaoTangDevices.bak'
